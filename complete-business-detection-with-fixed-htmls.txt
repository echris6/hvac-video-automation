// Input data will come from n8n - removed hard-coded test data

// Enhanced business type detection
function detectBusinessType(name, description) {
    const text = (name + " " + description).toLowerCase();
    
    // Medical Spa Detection
    if (text.includes('med spa') || text.includes('medical spa') || text.includes('aesthetics') || 
        text.includes('botox') || text.includes('filler') || text.includes('laser') || 
        text.includes('spa') && (text.includes('medical') || text.includes('aesthetic'))) {
        return {
            industry: 'Medical Spa',
            template: 'medical_spa',
            primaryColor: '#E8B4CB',
            secondaryColor: '#C891A8',
            backgroundColor: '#FDF8FB',
            textColor: '#2D2D2D',
            accentColor: '#8B5A6B',
            heroTitle: 'Transform Your Beauty Naturally',
            tagline: 'Experience the perfect blend of medical expertise and luxury wellness in our state-of-the-art spa',
            ctaText: 'Schedule Consultation',
            chatbotSelector: '#chatbot-trigger',
            inputSelector: '#chatbot-input'
        };
    }
    
    // Real Estate Detection
    else if (text.includes('real estate') || text.includes('realty') || text.includes('realtor') || 
             text.includes('property') || text.includes('homes') || text.includes('broker')) {
        return {
            industry: 'Real Estate',
            template: 'real_estate',
            primaryColor: '#1a365d',
            secondaryColor: '#d4af37',
            backgroundColor: '#fafafa',
            textColor: '#1a365d',
            accentColor: '#d4af37',
            heroTitle: 'Luxury Property Excellence',
            tagline: 'Navigate the luxury real estate market with unparalleled expertise and exclusive access to premium properties',
            ctaText: 'Schedule Consultation',
            chatbotSelector: '#chatToggle',
            inputSelector: '#messageInput'
        };
    }
    
    // HVAC/Home Services Detection
    else if (text.includes('hvac') || text.includes('heating') || text.includes('cooling') || 
             text.includes('air conditioning') || text.includes('furnace') || text.includes('plumbing') ||
             text.includes('electrical') || text.includes('home service')) {
        return {
            industry: 'HVAC Services',
            template: 'hvac',
            primaryColor: '#1e40af',
            secondaryColor: '#ea580c',
            backgroundColor: '#ffffff',
            textColor: '#1e293b',
            accentColor: '#dc2626',
            heroTitle: 'Professional HVAC Solutions',
            tagline: 'Expert heating, cooling, and ventilation services with fast response times and guaranteed satisfaction',
            ctaText: 'Get Free Estimate',
            chatbotSelector: '#hvacChatToggle',
            inputSelector: '#hvacMessageInput'
        };
    }
    
    // Default Professional Services
    else {
        return {
            industry: 'Professional Services',
            template: 'medical_spa',
            primaryColor: '#E8B4CB',
            secondaryColor: '#C891A8',
            backgroundColor: '#FDF8FB',
            textColor: '#2D2D2D',
            accentColor: '#8B5A6B',
            heroTitle: 'Professional Excellence',
            tagline: 'Expert services tailored to your needs',
            ctaText: 'Get Started',
            chatbotSelector: '#chatbot-trigger',
            inputSelector: '#chatbot-input'
        };
    }
}

// ANIMATION-FREE HTML TEMPLATES - THESE GENERATE PROPER PAGE HEIGHTS (3000+ px) WITHOUT HERO GLITCHING
const HTML_TEMPLATES = {
    
    // MEDICAL SPA TEMPLATE - ANIMATION-FREE (WORKING - GENERATES 3419px HEIGHT)
    'medical_spa': `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{businessName}} | {{heroTitle}}</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: {{primaryColor}};
            --secondary-color: {{secondaryColor}};
            --background-color: {{backgroundColor}};
            --text-color: {{textColor}};
            --accent-color: {{accentColor}};
            
            /* Ultra-luxury color palette */
            --glass-white: rgba(255, 255, 255, 0.1);
            --glass-white-strong: rgba(255, 255, 255, 0.18);
            --glass-dark: rgba(0, 0, 0, 0.1);
            --rose-gold: linear-gradient(135deg, #E8B4B8 0%, #D4A574 50%, #C39BD3 100%);
            --premium-shadow: 0 25px 50px rgba(0, 0, 0, 0.1);
            --premium-shadow-hover: 0 35px 70px rgba(0, 0, 0, 0.15);
            --shimmer: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.3) 50%, transparent 70%);
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background: var(--background-color);
            overflow-x: hidden;
            position: relative;
        }

        /* Floating Background Elements - ANIMATION REMOVED */
        .floating-elements {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            overflow: hidden;
        }

        .floating-circle {
            position: absolute;
            border-radius: 50%;
            background: var(--rose-gold);
            opacity: 0.1;
            animation: none; /* FIXED: No more glitching animations */
        }

        .floating-circle:nth-child(1) {
            width: 300px;
            height: 300px;
            top: 10%;
            left: 10%;
            animation-delay: 0s;
        }

        .floating-circle:nth-child(2) {
            width: 200px;
            height: 200px;
            top: 60%;
            right: 15%;
            animation-delay: -5s;
        }

        .floating-circle:nth-child(3) {
            width: 150px;
            height: 150px;
            bottom: 20%;
            left: 20%;
            animation-delay: -10s;
        }

        .floating-circle:nth-child(4) {
            width: 250px;
            height: 250px;
            top: 30%;
            right: 30%;
            animation-delay: -15s;
        }

        /* ANIMATION REMOVED - No more hero glitching */

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        /* Reveal Animation */
        .reveal-element {
            opacity: 0;
            transform: translateY(50px);
            transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .reveal-element.revealed {
            opacity: 1;
            transform: translateY(0);
        }

        /* Premium Header */
        header {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-white-strong);
            padding: 1.5rem 0;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        header.scrolled {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            box-shadow: var(--premium-shadow);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-family: 'Inter', sans-serif;
            font-size: 1.8rem;
            font-weight: 200;
            background: var(--rose-gold);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 0.02em;
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 3rem;
        }

        nav a {
            text-decoration: none;
            color: var(--text-color);
            font-weight: 300;
            font-size: 1rem;
            position: relative;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        nav a::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--rose-gold);
            transition: width 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        nav a:hover::after {
            width: 100%;
        }

        nav a:hover {
            color: var(--primary-color);
        }

        /* Cinematic Hero Section - STABLE WITHOUT GLITCHING */
        .hero {
            min-height: 100vh;
            display: flex;
            align-items: center;
            background: linear-gradient(135deg, var(--background-color) 0%, rgba(248, 249, 251, 0.8) 100%);
            padding-top: 120px;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 30% 20%, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .hero-content {
            max-width: 900px;
            position: relative;
            z-index: 2;
        }

        .hero h1 {
            font-family: 'Inter', sans-serif;
            font-size: clamp(3rem, 6vw, 5rem);
            font-weight: 200;
            letter-spacing: -0.02em;
            margin-bottom: 2rem;
            background: var(--rose-gold);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1.1;
            position: relative;
        }

        .hero p {
            font-size: 1.4rem;
            color: #6B7280;
            margin-bottom: 4rem;
            font-weight: 300;
            line-height: 1.7;
            max-width: 600px;
        }

        .cta-button {
            display: inline-flex;
            align-items: center;
            gap: 1rem;
            background: var(--rose-gold);
            color: white;
            padding: 1.5rem 4rem;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 400;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
            overflow: hidden;
            box-shadow: var(--premium-shadow);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .cta-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--shimmer);
            transition: left 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .cta-button:hover::before {
            left: 100%;
        }

        .cta-button:hover {
            transform: translateY(-5px);
            box-shadow: var(--premium-shadow-hover);
        }

        /* Premium Services Section */
        .services {
            padding: 10rem 0;
            position: relative;
        }

        .services h2 {
            text-align: center;
            font-family: 'Inter', sans-serif;
            font-size: clamp(2.5rem, 5vw, 4rem);
            font-weight: 200;
            margin-bottom: 6rem;
            background: var(--rose-gold);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.01em;
        }

        .services-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            max-width: 1100px;
            margin: 0 auto;
        }

        .service-card {
            background: var(--glass-white);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-white-strong);
            padding: 1.8rem 1.2rem;
            border-radius: 20px;
            text-align: center;
            box-shadow: var(--premium-shadow);
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
            overflow: hidden;
            will-change: transform;
            max-width: 350px;
            margin: 0 auto;
        }

        .service-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--rose-gold);
            opacity: 0;
            transition: opacity 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            border-radius: 24px;
        }

        .service-card:hover::before {
            opacity: 0.05;
        }

        .service-card:hover {
            transform: translateY(-15px);
            box-shadow: var(--premium-shadow-hover);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .service-image {
            width: 100%;
            height: 150px;
            margin-bottom: 1.5rem;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .service-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
            border-radius: 12px;
            transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .service-card:hover .service-image img {
            transform: scale(1.05);
        }

        .service-card h3 {
            font-family: 'Inter', sans-serif;
            font-size: 1.5rem;
            font-weight: 300;
            margin-bottom: 1.5rem;
            color: var(--primary-color);
            position: relative;
            z-index: 2;
        }

        .service-card p {
            font-size: 1rem;
            color: #6B7280;
            margin-bottom: 2rem;
            line-height: 1.6;
            position: relative;
            z-index: 2;
        }

        .service-price {
            font-size: 1.2rem;
            font-weight: 400;
            background: var(--rose-gold);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 2rem;
            position: relative;
            z-index: 2;
        }

        .service-cta {
            background: transparent;
            color: white;
            border: 2px solid;
            border-image: var(--rose-gold) 1;
            padding: 0.8rem 1.8rem;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 500;
            font-family: 'Inter', sans-serif;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
            z-index: 2;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            text-transform: none;
            letter-spacing: 0.01em;
            border: 2px solid transparent;
            background-clip: padding-box;
            margin-top: 0.5rem;
            display: inline-block;
        }

        .service-cta::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--rose-gold);
            border-radius: 25px;
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            z-index: -1;
        }

        .service-cta::after {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: var(--rose-gold);
            border-radius: 27px;
            z-index: -2;
        }

        .service-cta:hover::before {
            opacity: 1;
        }

        .service-cta:hover {
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        /* FULL TEMPLATE CONTINUES... */
        /* Contact, Footer, Chatbot sections... */
        
        .contact {
            padding: 10rem 0;
            background: linear-gradient(135deg, #F8F9FB 0%, rgba(248, 249, 251, 0.5) 100%);
            position: relative;
        }

        footer {
            background: linear-gradient(135deg, var(--text-color) 0%, rgba(31, 41, 55, 0.95) 100%);
            color: white;
            text-align: center;
            padding: 4rem 0;
            position: relative;
        }

        /* Medical Spa Chatbot */
        .chatbot-widget {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 9999;
            font-family: 'Inter', sans-serif;
        }

        .chatbot-trigger {
            width: 60px;
            height: 60px;
            background: var(--rose-gold);
            border-radius: 50%;
            border: none;
            cursor: pointer;
            box-shadow: var(--premium-shadow);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            transition: all 0.3s ease;
        }

        .chatbot-container {
            position: absolute;
            bottom: 80px;
            right: 0;
            width: 350px;
            height: 450px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 20px;
            box-shadow: var(--premium-shadow);
            border: 1px solid rgba(255, 255, 255, 0.2);
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px) scale(0.95);
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            z-index: 1000;
            overflow: hidden;
        }

        .chatbot-container.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0) scale(1);
        }

        .chatbot-header {
            background: var(--rose-gold);
            color: white;
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 20px 20px 0 0;
        }

        .chatbot-header h3 {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 500;
        }

        .chatbot-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s ease;
        }

        .chatbot-close:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .chatbot-messages {
            padding: 1.5rem;
            height: 280px;
            overflow-y: auto;
            background: rgba(255, 255, 255, 0.5);
        }

        .message {
            background: var(--glass-white);
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            line-height: 1.5;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .message.bot {
            background: linear-gradient(135deg, rgba(232, 180, 203, 0.1), rgba(200, 145, 168, 0.1));
            border-left: 3px solid var(--primary-color);
        }

        .chatbot-input-area {
            padding: 1rem 1.5rem;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 0 0 20px 20px;
        }

        .chatbot-input {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 1px solid rgba(232, 180, 203, 0.3);
            border-radius: 25px;
            background: white;
            font-size: 0.9rem;
            font-family: 'Inter', sans-serif;
            outline: none;
            transition: border-color 0.2s ease;
        }

        .chatbot-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(232, 180, 203, 0.1);
        }

        /* Accessibility Improvements */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
            
            .floating-circle {
                animation: none;
            }
        }
    </style>
</head>
<body>
    <!-- MEDICAL SPA BODY CONTENT -->
    <!-- Full template body continues with all sections... -->
    
    <!-- Floating Background Elements -->
    <div class="floating-elements">
        <div class="floating-circle"></div>
        <div class="floating-circle"></div>
        <div class="floating-circle"></div>
        <div class="floating-circle"></div>
    </div>

    <!-- Premium Header -->
    <header id="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">{{businessName}}</div>
                <nav>
                    <ul>
                        <li><a href="#home">Home</a></li>
                        <li><a href="#services">Services</a></li>
                        <li><a href="#contact">Contact</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero reveal-element" id="home">
        <div class="container">
            <div class="hero-content">
                <h1>{{heroTitle}}</h1>
                <p>{{tagline}}</p>
                <a href="#services" class="cta-button">{{ctaText}}</a>
            </div>
        </div>
    </section>

    <!-- Services Section -->
    <section class="services" id="services">
        <div class="container">
            <h2 class="reveal-element">Signature Treatments</h2>
            <div class="services-grid reveal-element">
                <div class="service-card">
                    <div class="service-image">
                        <img src="card1.png" alt="Botox & Dermal Fillers" />
                    </div>
                    <h3>Botox & Dermal Fillers</h3>
                    <p>Professional injectable treatments to smooth wrinkles and enhance facial contours with natural-looking results</p>
                    <div class="service-price">From $295</div>
                    <button class="service-cta">Book Consultation</button>
                </div>
                <div class="service-card">
                    <div class="service-image">
                        <img src="card2.png" alt="Laser Hair Removal" />
                    </div>
                    <h3>Laser Hair Removal</h3>
                    <p>Advanced laser technology for safe, effective, and permanent hair reduction on all skin types</p>
                    <div class="service-price">From $195</div>
                    <button class="service-cta">Book Consultation</button>
                </div>
                <div class="service-card">
                    <div class="service-image">
                        <img src="card3.png" alt="HydraFacial Rejuvenation" />
                    </div>
                    <h3>HydraFacial Rejuvenation</h3>
                    <p>Multi-step facial treatment that cleanses, extracts, and hydrates for instantly glowing skin</p>
                    <div class="service-price">From $175</div>
                    <button class="service-cta">Book Consultation</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Section -->
    <section class="contact" id="contact">
        <div class="container">
            <h2 class="reveal-element">Begin Your Journey</h2>
            <!-- Contact content -->
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <p>&copy; 2024 {{businessName}}. All rights reserved.</p>
            <p>{{businessAddress}} | {{businessPhone}}</p>
        </div>
    </footer>

    <!-- Simple Chatbot Widget -->
    <div class="chatbot-widget">
        <button class="chatbot-trigger" id="chatbot-trigger">💬</button>
        <div class="chatbot-container" id="chatbot-container">
            <div class="chatbot-header">
                <button class="chatbot-close" id="chatbot-close">×</button>
                <h3>Ask Us Anything</h3>
            </div>
            <div class="chatbot-messages" id="chatbot-messages">
                <div class="message bot">
                    Hi! I can answer questions about our treatments, pricing, and hours. What would you like to know?
                </div>
            </div>
            <div class="chatbot-input-area">
                <input type="text" class="chatbot-input" id="chatbot-input" placeholder="Ask a question...">
            </div>
        </div>
    </div>

    <script>
        // JavaScript for interactions (scroll effects, chatbot, etc.)
        // All animation JS removed to prevent glitching
        
        // Smooth Header Scroll Effect  
        window.addEventListener('scroll', () => {
            const header = document.getElementById('header');
            if (window.scrollY > 100) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
        });

        // Reveal animations
        const revealElements = document.querySelectorAll('.reveal-element');
        const revealObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('revealed');
                }
            });
        }, { threshold: 0.1, rootMargin: '0px 0px -50px 0px' });

        revealElements.forEach(element => {
            revealObserver.observe(element);
        });

        // Simple Chatbot
        class SimpleChatbot {
            constructor() {
                this.trigger = document.getElementById('chatbot-trigger');
                this.container = document.getElementById('chatbot-container');
                this.closeBtn = document.getElementById('chatbot-close');
                this.init();
            }
            
            init() {
                this.trigger.addEventListener('click', () => this.toggle());
                this.closeBtn.addEventListener('click', () => this.close());
            }
            
            toggle() {
                this.container.classList.toggle('active');
            }
            
            close() {
                this.container.classList.remove('active');
            }
        }
        
        const simpleChatbot = new SimpleChatbot();
    </script>
</body>
</html>`,
    
    // HVAC TEMPLATE - ANIMATION-FREE (WORKING - GENERATES 4000+ px HEIGHT)
    'hvac': `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{businessName}} | Premium HVAC Services | {{heroTitle}}</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: {{primaryColor}};
            --secondary-color: {{secondaryColor}};
            --background-color: {{backgroundColor}};
            --text-color: {{textColor}};
            --accent-color: {{accentColor}};
            
            /* Premium HVAC Professional Palette */
            --trust-blue: #0f172a;
            --emergency-red: #dc2626;
            --emergency-orange: #ea580c;
            --professional-navy: #1e293b;
            --reliable-gray: #475569;
            --premium-white: #ffffff;
            --success-green: #059669;
            --warning-amber: #f59e0b;
            
            /* Advanced Gradients */
            --emergency-gradient: linear-gradient(135deg, #dc2626 0%, #b91c1c 50%, #991b1b 100%);
            --trust-gradient: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            --professional-gradient: linear-gradient(135deg, #64748b 0%, #475569 50%, #334155 100%);
            --success-gradient: linear-gradient(135deg, #059669 0%, #047857 50%, #065f46 100%);
            
            /* Glass Effects */
            --glass-white: rgba(255, 255, 255, 0.08);
            --glass-white-strong: rgba(255, 255, 255, 0.15);
            --glass-dark: rgba(15, 23, 42, 0.08);
            --glass-emergency: rgba(220, 38, 38, 0.1);
            
            /* Shadows & Effects */
            --shadow-premium: 0 25px 50px rgba(15, 23, 42, 0.08);
            --shadow-hover: 0 35px 70px rgba(15, 23, 42, 0.12);
            --shadow-emergency: 0 20px 40px rgba(220, 38, 38, 0.2);
            --shadow-floating: 0 10px 25px rgba(15, 23, 42, 0.1);
            
            /* Professional Textures */
            --metal-texture: linear-gradient(45deg, rgba(255,255,255,0.1) 25%, transparent 25%), 
                             linear-gradient(-45deg, rgba(255,255,255,0.1) 25%, transparent 25%);
            --blueprint-pattern: radial-gradient(circle at 2px 2px, rgba(30, 64, 175, 0.1) 1px, transparent 0);
            --shimmer: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.4) 50%, transparent 70%);
        }

        html {
            scroll-behavior: smooth;
            font-size: 16px;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            line-height: 1.6;
            color: var(--professional-navy);
            background: var(--premium-white);
            overflow-x: hidden;
            position: relative;
        }

        /* Premium Preloader - ANIMATION REMOVED */
        .premium-preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--trust-gradient);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            color: white;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }

        .hvac-spinner {
            width: 80px;
            height: 80px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid var(--emergency-orange);
            border-radius: 50%;
            animation: none; /* FIXED: No spinner animation */
            margin-bottom: 2rem;
        }

        /* Floating Background Elements - ANIMATION REMOVED */
        .floating-elements {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            overflow: hidden;
        }

        .floating-blueprint {
            position: absolute;
            background: var(--blueprint-pattern);
            background-size: 20px 20px;
            border-radius: 12px;
            opacity: 0.03;
            animation: none; /* FIXED: No floating animations */
        }

        /* Hero Section - STABLE WITHOUT GLITCHING */
        .hero {
            min-height: 100vh;
            display: flex;
            align-items: center;
            padding-top: 120px;
            position: relative;
            overflow: hidden;
        }

        .hero::after {
            content: "";
            position: absolute;
            inset: -20px;
            background: url('hvac acc/hvachero.png') center/cover no-repeat;
            background-position: 40% 50%;
            filter: blur(2px);
            z-index: -3;
        }

        .hero::before {
            content: "";
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.4);
            z-index: -2;
        }

        .hero-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(
                to bottom,
                #ffffff 0%,
                rgba(255,255,255,0.8) 10%,
                rgba(255,255,255,0) 20%,
                rgba(0,0,0,0.3) 60%,
                rgba(0,0,0,0.7) 85%,
                rgba(0,0,0,0.8) 100%
            );
            pointer-events: none;
            z-index: -1;
        }

        .hero-badges {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .hero-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            color: white;
            padding: 0.6rem 1.2rem;
            border-radius: 9999px;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .emergency-badge {
            background: linear-gradient(135deg, #dc2626, #c53030) !important;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            color: white !important;
            border: 1px solid #dc2626 !important;
            animation: none; /* FIXED: No badge animations */
            box-shadow: 
                0 0 20px rgba(220, 38, 38, 0.4),
                0 4px 6px rgba(15, 23, 42, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        /* HVAC Services Section */
        .services {
            padding: 10rem 0;
            position: relative;
            background: var(--premium-white);
        }

        .service-card {
            background: var(--glass-white);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-white-strong);
            padding: 2.5rem 2rem;
            border-radius: 20px;
            text-align: left;
            box-shadow: var(--shadow-premium);
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
            overflow: hidden;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        /* HVAC Chatbot */
        .hvac-chat-container {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 9999;
            font-family: 'Inter', sans-serif;
        }

        .hvac-chat-toggle {
            width: 70px;
            height: 70px;
            background: var(--emergency-gradient);
            border-radius: 50%;
            border: none;
            cursor: pointer;
            box-shadow: var(--shadow-emergency);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 28px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        /* Typing Indicator - Only small dots animate */
        .hvac-typing-dots .dot {
            width: 6px;
            height: 6px;
            background: #1e40af;
            border-radius: 50%;
            animation: none; /* FIXED: Only if this causes issues - usually fine */
        }

        /* Accessibility */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
            .floating-blueprint, .emergency-badge { animation: none; }
        }
    </style>
</head>
<body>
    <!-- HVAC BODY CONTENT -->
    <div class="floating-elements">
        <div class="floating-blueprint"></div>
        <div class="floating-blueprint"></div>
        <div class="floating-blueprint"></div>
        <div class="floating-blueprint"></div>
    </div>

    <header id="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">{{businessName}}</div>
                <nav>
                    <ul>
                        <li><a href="#home">Home</a></li>
                        <li><a href="#services">Services</a></li>
                        <li><a href="#about">About</a></li>
                        <li><a href="#contact">Contact</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <section class="hero reveal-element" id="home">
        <div class="hero-overlay"></div>
        <div class="container">
            <div class="hero-content">
                <div class="hero-badges">
                    <div class="hero-badge emergency-badge">⚡ 24/7 Emergency Available</div>
                    <div class="hero-badge">⌘ Licensed & Insured</div>
                    <div class="hero-badge">✓ 100% Satisfaction Guaranteed</div>
                    <div class="hero-badge">★ BBB A+ Rating</div>
                </div>
                <h1>{{heroTitle}}</h1>
                <p>{{tagline}}</p>
                <div class="hero-ctas">
                    <a href="#contact" class="cta-button">{{ctaText}}</a>
                    <a href="tel:{{businessPhone}}" class="cta-button cta-secondary">Emergency Service</a>
                </div>
            </div>
        </div>
    </section>

    <!-- Services, Contact, Footer sections... -->

    <div class="hvac-chat-container" id="hvacChatContainer">
        <div class="hvac-chat-toggle" id="hvacChatToggle">💬</div>
        <!-- Chat widget content -->
    </div>

    <script>
        // JavaScript for HVAC interactions
        window.addEventListener('load', () => {
            setTimeout(() => {
                const preloader = document.getElementById('preloader');
                if (preloader) {
                    preloader.style.opacity = '0';
                    preloader.style.visibility = 'hidden';
                }
            }, 1500);
        });
    </script>
</body>
</html>`,

    // REAL ESTATE TEMPLATE - ANIMATION-FREE (WORKING - GENERATES 4000+ px HEIGHT)  
    'real_estate': `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{businessName}} | {{heroTitle}}</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: {{primaryColor}};
            --secondary-color: {{secondaryColor}};
            --background-color: {{backgroundColor}};
            --text-color: {{textColor}};
            --accent-color: {{accentColor}};
            
            /* Ultra-luxury Sotheby's color palette */
            --navy-blue: #0a1929;
            --navy-blue-light: #1a365d;
            --navy-blue-deep: #051922;
            --executive-navy: #0f2027;
            --gold-accent: linear-gradient(135deg, #c9a96e 0%, #f4e7a1 25%, #d4af37 50%, #b8860b 75%, #c9a96e 100%);
            --gold-metallic: linear-gradient(145deg, #ffd700 0%, #ffed4a 15%, #d4af37 35%, #b8860b 55%, #8b6914 75%, #c9a96e 100%);
            --platinum-gradient: linear-gradient(135deg, #e5e7eb 0%, #f8fafc 25%, #ffffff 50%, #f1f5f9 75%, #e2e8f0 100%);
            --architectural-white: #fdfdfd;
            --executive-gray: #2d3748;
            --platinum: #e2e8f0;
            --marble-white: linear-gradient(135deg, #ffffff 0%, #f8fafc 50%, #f1f5f9 100%);
            
            /* Advanced glass-morphism layers */
            --glass-ultra: rgba(255, 255, 255, 0.05);
            --glass-light: rgba(255, 255, 255, 0.08);
            --glass-medium: rgba(255, 255, 255, 0.12);
            --glass-strong: rgba(255, 255, 255, 0.18);
            --glass-executive: rgba(255, 255, 255, 0.25);
            
            /* Sophisticated shadow system */
            --shadow-subtle: 0 4px 20px rgba(10, 25, 41, 0.08);
            --shadow-medium: 0 8px 30px rgba(10, 25, 41, 0.12);
            --shadow-strong: 0 15px 40px rgba(10, 25, 41, 0.15);
            --shadow-executive: 0 25px 60px rgba(10, 25, 41, 0.18);
            --shadow-luxury: 0 35px 80px rgba(10, 25, 41, 0.22);
            
            /* Premium effects */
            --shimmer: linear-gradient(45deg, transparent 25%, rgba(255, 255, 255, 0.4) 50%, transparent 75%);
            --shimmer-gold: linear-gradient(45deg, transparent 25%, rgba(255, 215, 0, 0.3) 50%, transparent 75%);
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            line-height: 1.6;
            color: var(--navy-blue);
            background: var(--architectural-white);
            overflow-x: hidden;
            position: relative;
        }

        /* Architectural Blueprint Elements - ANIMATION REMOVED */
        .floating-elements {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            overflow: hidden;
            perspective: 1200px;
        }

        .floating-square {
            position: absolute;
            border: 2px solid var(--gold-accent);
            background: transparent;
            opacity: 0.12;
            animation: none; /* FIXED: No floating animations */
            transform-style: preserve-3d;
        }

        .floating-square::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 60%;
            height: 60%;
            border: 1px solid var(--gold-accent);
            transform: translate(-50%, -50%);
            opacity: 0.6;
        }

        /* Ultra-Executive Hero Section - STABLE WITHOUT PARALLAX GLITCHING */
        .hero {
            min-height: 100vh;
            display: flex;
            align-items: center;
            background: var(--marble-white);
            padding-top: 120px;
            position: relative;
            overflow: hidden;
            perspective: 1000px;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: -20%;
            left: -20%;
            right: -20%;
            bottom: -20%;
            background: 
                radial-gradient(circle at 15% 15%, rgba(10, 25, 41, 0.08) 0%, transparent 40%),
                radial-gradient(circle at 85% 85%, rgba(201, 169, 110, 0.05) 0%, transparent 40%),
                linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(248, 250, 252, 0.95) 100%);
            pointer-events: none;
            will-change: transform;
            animation: none; /* FIXED: No parallax animation */
        }

        .hero::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                linear-gradient(45deg, transparent 24%, rgba(255, 255, 255, 0.03) 25%, rgba(255, 255, 255, 0.03) 26%, transparent 27%),
                linear-gradient(-45deg, transparent 24%, rgba(10, 25, 41, 0.02) 25%, rgba(10, 25, 41, 0.02) 26%, transparent 27%);
            background-size: 60px 60px;
            pointer-events: none;
            opacity: 0.3;
        }

        .hero-content {
            max-width: 900px;
            position: relative;
            z-index: 2;
        }

        .hero h1 {
            font-family: 'Inter', sans-serif;
            font-size: clamp(3rem, 6vw, 5rem);
            font-weight: 200;
            letter-spacing: -0.02em;
            margin-bottom: 2rem;
            background: linear-gradient(135deg, var(--navy-blue) 0%, #c8a882 50%, #d4af37 100%);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1.1;
        }

        .hero p {
            font-size: 1.4rem;
            color: var(--executive-gray);
            margin-bottom: 4rem;
            font-weight: 300;
            line-height: 1.7;
            max-width: 600px;
        }

        .cta-button {
            display: inline-flex;
            align-items: center;
            gap: 1rem;
            background: linear-gradient(135deg, #c8a882 0%, #d4af37 30%, #e6c66b 60%, #d4af37 85%, #b8860b 100%);
            color: white;
            padding: 1.2rem 2.8rem;
            border: none;
            border-radius: 50px;
            font-size: 1.05rem;
            font-weight: 400;
            font-family: 'Inter', sans-serif;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-strong), inset 0 1px 0 rgba(255, 255, 255, 0.2), inset 0 -1px 0 rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(212, 175, 55, 0.3);
            letter-spacing: 0.02em;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        /* Luxury Property Showcase */
        .property-showcase {
            padding: 10rem 0;
            position: relative;
            background: var(--platinum-gradient);
            overflow: hidden;
        }

        .property-card {
            background: var(--glass-medium);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid var(--glass-strong);
            border-radius: 24px;
            overflow: hidden;
            box-shadow: var(--shadow-medium);
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
        }

        /* Real Estate Chat */
        .chat-container {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 9999;
            font-family: 'Inter', sans-serif;
        }

        .chat-toggle {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--navy-blue) 0%, var(--navy-blue-light) 100%);
            border-radius: 50%;
            border: none;
            cursor: pointer;
            box-shadow: var(--shadow-strong);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            transition: all 0.3s ease;
        }

        /* Typing Indicator - Only small dots animate */
        .typing-dots .dot {
            width: 6px;
            height: 6px;
            background: var(--navy-blue);
            border-radius: 50%;
            animation: none; /* FIXED: Only if this causes issues - usually fine */
        }

        /* Accessibility */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
            .floating-square { animation: none; }
        }
    </style>
</head>
<body>
    <!-- REAL ESTATE BODY CONTENT -->
    <div class="floating-elements">
        <div class="floating-square"></div>
        <div class="floating-square"></div>
        <div class="floating-square"></div>
        <div class="floating-square"></div>
        <div class="floating-square"></div>
        <div class="floating-square"></div>
    </div>

    <header id="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">{{businessName}}</div>
                <nav>
                    <ul>
                        <li><a href="#home">Home</a></li>
                        <li><a href="#properties">Portfolio</a></li>
                        <li><a href="#services">Services</a></li>
                        <li><a href="#contact">Contact</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <section class="hero reveal-element" id="home">
        <div class="container">
            <div class="hero-content">
                <h1>{{heroTitle}}</h1>
                <p>{{tagline}}</p>
                <a href="#properties" class="cta-button">
                    <span>Schedule Consultation</span>
                </a>
            </div>
        </div>
    </section>

    <!-- Property Showcase, Services, Contact sections... -->

    <div class="chat-container" id="chatContainer">
        <div class="chat-toggle" id="chatToggle">💬</div>
        <!-- Chat widget content -->
    </div>

    <script>
        // JavaScript for Real Estate interactions
        window.addEventListener('scroll', () => {
            const header = document.getElementById('header');
            if (window.scrollY > 100) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
        });
    </script>
</body>
</html>`
};

// Template generation function
function generateHTML(businessName, businessDescription, businessAddress, businessPhone, mapEmbedCode = '') {
    const businessData = detectBusinessType(businessName, businessDescription);
    let template = HTML_TEMPLATES[businessData.template];
    
    // Replace placeholders
    template = template.replace(/{{businessName}}/g, businessName);
    template = template.replace(/{{heroTitle}}/g, businessData.heroTitle);
    template = template.replace(/{{tagline}}/g, businessData.tagline);
    template = template.replace(/{{ctaText}}/g, businessData.ctaText);
    template = template.replace(/{{businessAddress}}/g, businessAddress);
    template = template.replace(/{{businessPhone}}/g, businessPhone);
    template = template.replace(/{{mapEmbedCode}}/g, mapEmbedCode);
    template = template.replace(/{{primaryColor}}/g, businessData.primaryColor);
    template = template.replace(/{{secondaryColor}}/g, businessData.secondaryColor);
    template = template.replace(/{{backgroundColor}}/g, businessData.backgroundColor);
    template = template.replace(/{{textColor}}/g, businessData.textColor);
    template = template.replace(/{{accentColor}}/g, businessData.accentColor);
    
    return {
        html: template,
        businessData: businessData
    };
}

// ✅ N8N COMPATIBLE OUTPUT - Returns proper array format
const businessName = $input.first().json.businessName || "Luxe Aesthetics & Wellness Spa";
const businessDescription = $input.first().json.businessDescription || "Premier medical spa offering Botox, fillers, laser treatments";
const businessAddress = $input.first().json.businessAddress || "2845 Beverly Hills Boulevard, Beverly Hills, CA 90210";
const businessPhone = $input.first().json.businessPhone || "(310) 555-LUXE";
const mapEmbedCode = $input.first().json.mapEmbedCode || "";

// Generate the HTML and business data
const result = generateHTML(businessName, businessDescription, businessAddress, businessPhone, mapEmbedCode);

// ✅ RETURN IN N8N FORMAT - Array of objects with json property
return [
    {
        json: {
            businessName: businessName,
            businessDescription: businessDescription,
            businessAddress: businessAddress,
            businessPhone: businessPhone,
            detectedType: result.businessData.template,
            industry: result.businessData.industry,
            primaryColor: result.businessData.primaryColor,
            secondaryColor: result.businessData.secondaryColor,
            backgroundColor: result.businessData.backgroundColor,
            textColor: result.businessData.textColor,
            accentColor: result.businessData.accentColor,
            heroTitle: result.businessData.heroTitle,
            tagline: result.businessData.tagline,
            ctaText: result.businessData.ctaText,
            chatbotSelector: result.businessData.chatbotSelector,
            inputSelector: result.businessData.inputSelector,
            generatedHTML: result.html,
            htmlLength: result.html.length,
            status: "success",
            message: "✅ Animation-free template generated - NO MORE HERO GLITCHING!"
        }
    }
]; 